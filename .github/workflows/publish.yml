name: Verify Release Assets

on:
  release:
    types: [published]
  workflow_dispatch:  # Allow manual trigger for testing

permissions:
  contents: read

jobs:
  verify-release-assets:
    name: Verify Release Assets
    runs-on: ubuntu-latest
    
    steps:
    - name: Verify release assets
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      shell: bash
      run: |
        TAG_NAME="${{ github.event.release.tag_name }}"
        echo "ðŸ“¦ Verifying release assets for $TAG_NAME..."
        gh release view "$TAG_NAME" --repo ${{ github.repository }}

    - name: Create release summary
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      shell: bash
      run: |
        TAG_NAME="${{ github.event.release.tag_name }}"
        echo "## ðŸ“¦ Release Published" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "Release **$TAG_NAME** has been published with executables." >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### Available Downloads" >> $GITHUB_STEP_SUMMARY
        echo '```bash' >> $GITHUB_STEP_SUMMARY
        echo "# Windows" >> $GITHUB_STEP_SUMMARY
        echo "gh release download $TAG_NAME --pattern 'AuthMatrix-windows.exe'" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "# Linux" >> $GITHUB_STEP_SUMMARY
        echo "gh release download $TAG_NAME --pattern 'AuthMatrix-linux'" >> $GITHUB_STEP_SUMMARY
        echo '```' >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### Release Assets" >> $GITHUB_STEP_SUMMARY
        gh release view "$TAG_NAME" --json assets --jq '.assets[] | "- \(.name) (\(.size) bytes)"' >> $GITHUB_STEP_SUMMARY
